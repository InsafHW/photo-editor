[{"D:\\Программирование\\React\\MyApps\\new-editor\\src\\index.tsx":"1","D:\\Программирование\\React\\MyApps\\new-editor\\src\\reportWebVitals.ts":"2","D:\\Программирование\\React\\MyApps\\new-editor\\src\\App.tsx":"3","D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\reducers\\history.tsx":"4","D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\actions.tsx":"5","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Toolbar\\Toolbar.tsx":"6","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\Navbar.tsx":"7","D:\\Программирование\\React\\MyApps\\new-editor\\src\\modelsTS\\Editor.tsx":"8","D:\\Программирование\\React\\MyApps\\new-editor\\src\\modelsTS\\Filter.tsx":"9","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\ImportPhotoFromPC\\ImportPhotoFromPC.tsx":"10","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\ExportToPC\\ExportToPC.tsx":"11","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\ImportPhotoFromPixels\\ImportPhotoFromPixels.tsx":"12","D:\\Программирование\\React\\MyApps\\new-editor\\src\\functionsTS\\ExportToPC.tsx":"13","D:\\Программирование\\React\\MyApps\\new-editor\\src\\functionsTS\\DrawHelper.tsx":"14","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Canvas\\canvasNewEdi.tsx":"15","D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\reducers\\view.tsx":"16","D:\\Программирование\\React\\MyApps\\new-editor\\src\\functionsTS\\DrawElements.tsx":"17","D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\reducers\\editor.tsx":"18"},{"size":901,"mtime":1608618061003,"results":"19","hashOfConfig":"20"},{"size":425,"mtime":1607492189300,"results":"21","hashOfConfig":"20"},{"size":1603,"mtime":1608205070026,"results":"22","hashOfConfig":"20"},{"size":509,"mtime":1607605817185,"results":"23","hashOfConfig":"20"},{"size":653,"mtime":1607600646324,"results":"24","hashOfConfig":"20"},{"size":4674,"mtime":1608014195445,"results":"25","hashOfConfig":"20"},{"size":497,"mtime":1607492188814,"results":"26","hashOfConfig":"20"},{"size":519,"mtime":1608618987777,"results":"27","hashOfConfig":"20"},{"size":96,"mtime":1607492189238,"results":"28","hashOfConfig":"20"},{"size":4763,"mtime":1608617184027,"results":"29","hashOfConfig":"20"},{"size":3585,"mtime":1608621633826,"results":"30","hashOfConfig":"20"},{"size":265,"mtime":1607492188783,"results":"31","hashOfConfig":"20"},{"size":451,"mtime":1607492189069,"results":"32","hashOfConfig":"20"},{"size":2645,"mtime":1608012476062,"results":"33","hashOfConfig":"20"},{"size":21180,"mtime":1608617339462,"results":"34","hashOfConfig":"20"},{"size":761,"mtime":1607493464018,"results":"35","hashOfConfig":"20"},{"size":1039,"mtime":1608617132481,"results":"36","hashOfConfig":"20"},{"size":3177,"mtime":1608619001026,"results":"37","hashOfConfig":"20"},{"filePath":"38","messages":"39","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},"1tlljv2",{"filePath":"41","messages":"42","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"43","messages":"44","errorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"45","usedDeprecatedRules":"40"},{"filePath":"46","messages":"47","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"48","usedDeprecatedRules":"40"},{"filePath":"49","messages":"50","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"51","messages":"52","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"53","usedDeprecatedRules":"40"},{"filePath":"54","messages":"55","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"56","usedDeprecatedRules":"40"},{"filePath":"57","messages":"58","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"59","messages":"60","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"61","messages":"62","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"63","usedDeprecatedRules":"40"},{"filePath":"64","messages":"65","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"66","messages":"67","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"68","messages":"69","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"70","messages":"71","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"72","usedDeprecatedRules":"73"},{"filePath":"74","messages":"75","errorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"76","usedDeprecatedRules":"40"},{"filePath":"77","messages":"78","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"79","messages":"80","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"40"},{"filePath":"81","messages":"82","errorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"83","usedDeprecatedRules":"40"},"D:\\Программирование\\React\\MyApps\\new-editor\\src\\index.tsx",[],["84","85"],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\reportWebVitals.ts",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\App.tsx",["86","87","88","89"],"import React, {useState, useRef, useEffect} from 'react';\nimport { connect } from \"react-redux\"\nimport * as actionTypes from \"./store/actions\"\nimport Navbar from \"./components/Navbar/Navbar\"\n// import Holst from \"./components/Holst/Holst\"\nimport Toolbar from \"./components/Toolbar/Toolbar\"\nimport classes from \"./App.module.css\"\nimport { Tool } from './modelsTS/Editor';\nimport Canvas from \"./components/Canvas/canvas\"\nimport NewCanvas from \"./components/Canvas/canvasNewEdi\"\n\nfunction App(props: any) {\n  useEffect(() => {\n    const listener = (e: KeyboardEvent) => {\n      if (e.ctrlKey && e.key === 'z') {\n        console.log('[history]', props.history)\n        alert(\"CTRL Z\")\n        props.saveImageData(props.history[props.currentId - 1]);\n      } else if (e.ctrlKey && e.key === 'y') {\n        // redo\n        console.log('[history]', props.history)\n        alert(\"CTRL Y\")\n      }\n    }\n    window.addEventListener(\"keydown\", listener);\n    return () => {\n      window.removeEventListener(\"keydown\", listener)\n    }\n  })\n\n  return (\n    <React.Fragment>\n      <div className={classes.App}>\n        <Navbar/>\n        <NewCanvas/>\n        {/* <Cnvs /> */}\n        <Toolbar/>\n      </div>\n    </React.Fragment>\n    \n  )\n}\n\nconst mapStateToProps = (state: any) => {\n  return {\n    history: state.history.history,\n    currentId: state.editor.currentId\n  }\n}\n\nconst mapDispatchToProps = (dispatch: Function) => {\n  return {\n    saveImageData: (imgData: ImageData) => dispatch({type: actionTypes.SAVE_IMAGE_DATA, data: imgData})\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\n","D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\reducers\\history.tsx",["90","91","92"],"import { Editor, Tool } from '../../modelsTS/Editor';\r\nimport { Filter } from '../..//modelsTS/Filter';\r\n\r\nimport * as actionTypes from \"../actions\"\r\n\r\nconst initialState = {\r\n  history: []\r\n}\r\n\r\nconst reducer = (state = initialState, action: any) => {\r\n  switch (action.type) {\r\n    case actionTypes.PUT_IN_HISTORY:\r\n      console.log('[PUT IN HOSTORY]', state)\r\n      return {\r\n        history: state.history.concat(action.data)\r\n      }\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default reducer;","D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\actions.tsx",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Toolbar\\Toolbar.tsx",["93"],"import { stat } from 'fs';\r\nimport React, {useState} from 'react';\r\nimport { IoEllipseOutline, IoTriangleOutline, IoSquareOutline, IoColorFilterOutline, IoCutOutline } from \"react-icons/io5\"\r\nimport {SketchPicker} from \"react-color\"\r\nimport { BiText, BiSelection } from \"react-icons/bi\"\r\nimport { connect } from \"react-redux\";\r\nimport { Tool } from '../../modelsTS/Editor'\r\nimport * as actionTypes from \"../../store/actions\"\r\nimport classes from \"./Toolbar.module.css\"\r\nimport { Filter } from '../../modelsTS/Filter';\r\n\r\nconst Toolbar = (props: any) => {\r\n  const [showFilters, setShowFilters] = useState(false);\r\n  let trCls = null, crcCls = null, rectCls = null, textCls = null, areaCls = null;\r\n  switch (props.tool) {\r\n    case Tool.triangle:\r\n      trCls = classes.active;\r\n      break;\r\n    case Tool.rectangle:\r\n      rectCls = classes.active;\r\n      break;\r\n    case Tool.ellipse:\r\n      crcCls = classes.active;\r\n      break;\r\n    case Tool.text:\r\n      textCls = classes.active;\r\n      break;\r\n    case Tool.area:\r\n      areaCls = classes.active;\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <div className={classes.Toolbar}>\r\n        <IoTriangleOutline \r\n            className={[classes.tool, trCls, classes.triangle].join(' ')} \r\n            size=\"2em\" onClick={() => props.changeTool(Tool.triangle)} \r\n        />\r\n        <IoEllipseOutline \r\n            className={[classes.tool, crcCls].join(' ')} \r\n            size=\"2em\" \r\n            onClick={() => props.changeTool(Tool.ellipse)}\r\n        />\r\n        <IoSquareOutline \r\n            className={[classes.tool, rectCls].join(' ')} \r\n            size=\"2em\" \r\n            onClick={() => props.changeTool(Tool.rectangle)}\r\n        />\r\n        <BiText \r\n            className={[classes.tool, textCls].join(' ')} \r\n            size=\"2em\" \r\n            onClick={() => props.changeTool(Tool.text)}/>\r\n        <IoColorFilterOutline \r\n            className={classes.tool} \r\n            size=\"2em\" \r\n            onClick={() => setShowFilters(!showFilters)}\r\n        />\r\n        <IoCutOutline \r\n            className={classes.tool} \r\n            size=\"2em\" \r\n            onClick={() => props.tool === 'area' ? props.deleteSelectedArea() : alert('Выделите область!')}\r\n        />\r\n        <BiSelection \r\n            className={[classes.tool, areaCls].join(' ')} \r\n            size=\"2em\" \r\n            onClick={() => props.changeTool(Tool.area)}\r\n        />\r\n    </div>\r\n    {showFilters ? (\r\n      <div className={classes.FilterMenu}>\r\n        <div className={[classes.Filter, classes.Grey].join(' ')} onClick={() => props.applyFilter(Filter.grey)}></div>\r\n        <div className={[classes.Filter, classes.Red].join(' ')} onClick={() => props.applyFilter(Filter.red)}></div>\r\n        <div className={[classes.Filter, classes.Green].join(' ')} onClick={() => props.applyFilter(Filter.green)}></div>\r\n        <div className={[classes.Filter, classes.Blue].join(' ')} onClick={() => props.applyFilter(Filter.blue)}></div>\r\n      </div>\r\n    ) : null}\r\n    {\r\n      trCls || rectCls || crcCls || textCls ? (\r\n        <div className={classes.FillColorMenu}>\r\n          <SketchPicker color={props.fillColor} onChange={(color) => props.changeFillColor(color.hex)}/>\r\n        </div>\r\n      ) : null\r\n    }\r\n    {textCls ? (\r\n      <div className={classes.textMenu}>\r\n        <span>Размер текста...</span>\r\n        <input type=\"number\" min=\"1\" max=\"90\" value={props.fontSize} onChange={(e) => props.changeFontSize(+e.target.value)}/>\r\n        <input type=\"text\" placeholder=\"Введите текст...\" value={props.text} onChange={(e) => props.changeText(e.target.value)}/>\r\n      </div>\r\n    ) : null}\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    tool: state.editor.currentTool,\r\n    fillColor: state.view.fillColor,\r\n    text: state.view.text,\r\n    fontSize: state.view.fontSize\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Function) => {\r\n  return {\r\n    changeTool: (newTool: any) => dispatch({type: actionTypes.CHANGE_CURRENT_TOOL, tool: newTool}),\r\n    deleteSelectedArea: () => dispatch({type: actionTypes.DELETE_SELECTED_AREA}),\r\n    changeText: (text: string) => dispatch({type: actionTypes.CHANGE_TEXT, value: text}),\r\n    changeFillColor: (color: any) => dispatch({type: actionTypes.CHANGE_FILL_COLOR, value: color}),\r\n    changeFontSize: (size: number) => dispatch({type: actionTypes.CHANGE_FONT_SIZE, value: size}),\r\n    applyFilter: (color: Filter) => dispatch({type: actionTypes.APPLY_FILTER, color: color})\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Toolbar);","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\Navbar.tsx",["94"],"import React, {useRef} from 'react'\r\n\r\nimport classes from \"./Navbar.module.css\"\r\nimport ImportPhotoFromPC from \"./ImportPhotoFromPC/ImportPhotoFromPC\"\r\nimport ImportPhotoFromPixels from \"./ImportPhotoFromPixels/ImportPhotoFromPixels\"\r\nimport ExportToPC from \"./ExportToPC/ExportToPC\"\r\n\r\nconst Navbar = (props: any) => {\r\n  return (\r\n    <nav className={classes.Navbar}>\r\n      <ImportPhotoFromPC/>\r\n      <ImportPhotoFromPixels/>\r\n      <ExportToPC />\r\n    </nav>\r\n  )\r\n}\r\n\r\nexport default Navbar","D:\\Программирование\\React\\MyApps\\new-editor\\src\\modelsTS\\Editor.tsx",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\modelsTS\\Filter.tsx",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\ImportPhotoFromPC\\ImportPhotoFromPC.tsx",["95"],"import React, {useRef} from 'react'\r\nimport * as actionTypes from \"../../../store/actions\"\r\nimport { connect } from 'react-redux'\r\nimport classes from './ImportPhotoFromPC.module.css'\r\nimport {ImageUI} from \"../../../modelsTS/ImagUI\"\r\nimport {drawEllipse, drawRectangle, drawTriangle} from \"../../../functionsTS/DrawElements\"\r\n\r\nconst importPhotoFromPC = (props: any) => {\r\n  const importHandler = (e: any) => {\r\n    if (e.target && e.target.files) {\r\n      const file = e.target.files[0]\r\n      const reader = new FileReader()\r\n      if (!reader) return;\r\n      reader.readAsDataURL(file)\r\n      reader.addEventListener(\"load\", () => {\r\n        if (!reader.result) {\r\n          return;\r\n        }\r\n        let url = reader.result?.toString()\r\n        const image = new Image();\r\n        image.src = url;\r\n        const canv = document.querySelector('#canvas') as HTMLCanvasElement;\r\n        const ctx = canv.getContext('2d');\r\n        ctx?.clearRect(0, 0, canv.width, canv.height);\r\n        ctx?.putImageData(props.canvas, 0, 0);\r\n        // ctx?.fillText('PRIVE', 10, 200)\r\n        if (props.selectedObj) {\r\n          if (ctx) {\r\n            ctx.fillStyle = props.selectedObj.fillColor;\r\n          }\r\n          if (props.selectedObj.type === 'image') {\r\n            console.log('[OLD IMAGE]', props.selectedObj)\r\n            const image = new Image();\r\n            image.src = props.selectedObj.src;\r\n            image.onload = () => {\r\n              ctx?.drawImage(image, props.selectedObj.topLeft.x, props.selectedObj.topLeft.y, props.selectedObj.size.width, props.selectedObj.size.height)\r\n              const imgData = ctx?.getImageData(0, 0, canv.width, canv.height);\r\n              props.saveImageData(imgData);\r\n            }\r\n          } else if (props.selectedObj.type === 'text') {\r\n            console.log('[TEXT]', props.selectedObj)\r\n            // ctx?.fillText('PRIVE', 10, 200)\r\n            ctx?.fillText(props.selectedObj.text, props.selectedObj.topLeft.x, props.selectedObj.topLeft.y)\r\n          } else {\r\n            const object = {\r\n              topLeft: {\r\n                x: props.selectedObj.topLeft.x,\r\n                y: props.selectedObj.topLeft.y\r\n              },\r\n              size: {\r\n                width: props.selectedObj.size.width,\r\n                height: props.selectedObj.size.height\r\n              }\r\n            }\r\n            switch (props.selectedObj.type) {\r\n              case 'rectangle':\r\n                drawRectangle(object, ctx);\r\n                break;\r\n              case 'triangle':\r\n                drawTriangle(object, ctx);\r\n                break;\r\n              case 'ellipse':\r\n                drawEllipse(object, ctx);\r\n                break;\r\n              default:\r\n                break;\r\n            }   \r\n          }\r\n          const imgData = ctx?.getImageData(0, 0, canv.width, canv.height);\r\n          props.saveImageData(imgData);\r\n        }\r\n        image.onload = () => {\r\n          const width = image.width > canv.width ? canv.width : image.width;\r\n          const height = image.height > canv.height ? canv.height : image.height;\r\n          ctx?.drawImage(image, 0, 0, width, height)\r\n          const img: ImageUI = {\r\n            topLeft: {\r\n              x: 0,\r\n              y: 0\r\n            },\r\n            size: {\r\n              width: width,\r\n              height: height\r\n            },\r\n            src: url,\r\n            type: 'image'\r\n          }\r\n          props.changeSelectedObject(img);\r\n        }\r\n      })\r\n    }\r\n  }\r\n  return (\r\n    <div className={classes.example}>\r\n      <label className={classes.label}>\r\n        <i className=\"material-icons\">attach_file</i>\r\n        <span className={classes.title}>Добавить файл</span>\r\n        <input type=\"file\" onChange={importHandler}/>\r\n      </label>\r\n    </div>\r\n  )\r\n}\r\n\r\n// function drawImage(object: any, ctx: CanvasRenderingContext2D | undefined | null) {\r\n//   const image = new Image();\r\n//   image.src = object.src;\r\n//   image.onload = () => {\r\n//     ctx?.drawImage(image, object.topLeft.x, object.topLeft.y, object.size.width, object.size.height)\r\n//     const imgData = ctx?.getImageData(0, 0, canv.width, canv.height);\r\n//     props.saveImageData(imgData);\r\n//   }\r\n// }\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    selectedObj: state.editor.selectedObject,\r\n    canvas: state.editor.canvas\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: Function) => {\r\n  return {\r\n    changeSelectedObject: (object: any) => dispatch({type: actionTypes.CHANGE_SELECTED_OBJECT, newObject: object}),\r\n    saveImageData: (imgData: ImageData) => dispatch({type: actionTypes.SAVE_IMAGE_DATA, data: imgData})\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(importPhotoFromPC);","D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\ExportToPC\\ExportToPC.tsx",["96","97"],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Navbar\\ImportPhotoFromPixels\\ImportPhotoFromPixels.tsx",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\functionsTS\\ExportToPC.tsx",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\functionsTS\\DrawHelper.tsx",["98","99","100"],"import { ImageUI } from '../modelsTS/ImagUI';\r\nimport { Ellipse, Rectangle, Triangle } from \"../modelsTS/Primitives\"\r\nimport { TextUI } from '../modelsTS/TextUI';\r\n\r\nexport function drawRectangle(object: any, ctx: CanvasRenderingContext2D | undefined | null) {\r\n  ctx?.fillRect(object.topLeft.x, object.topLeft.y, object.size.width, object.size.height);\r\n}\r\n\r\nexport function drawEllipse(object: any, ctx: CanvasRenderingContext2D | undefined | null) {\r\n  let radiusX = object.size.width / 2;\r\n  let radiusY = object.size.height / 2;\r\n  let centerX = object.topLeft.x + radiusX;\r\n  let centerY = object.topLeft.y + radiusY;\r\n  ctx?.beginPath();\r\n  ctx?.ellipse(centerX, centerY, radiusX, radiusY, 0, 0, Math.PI * 2);\r\n  ctx?.fill();\r\n}\r\n\r\nexport function drawTriangle(object: any, ctx: CanvasRenderingContext2D | undefined | null) {\r\n  ctx?.beginPath();\r\n  ctx?.moveTo(object.topLeft.x, object.topLeft.y + object.size.height);\r\n  ctx?.lineTo(object.topLeft.x + object.size.width / 2, object.topLeft.y);\r\n  ctx?.lineTo(object.topLeft.x + object.size.width, object.topLeft.y + object.size.height);\r\n  ctx?.lineTo(object.topLeft.x, object.topLeft.y + object.size.height);\r\n  ctx?.fill();\r\n}\r\n\r\nexport function drawText(textObj: TextUI, ctx: CanvasRenderingContext2D | undefined | null): void {\r\n  if (!ctx)\r\n    return;\r\n  ctx.font = `normal ${textObj.fontSize}px Open-sans, sans-serif`;\r\n  ctx.fillStyle = textObj.fillColor;\r\n  ctx.fillText(textObj.text, textObj.topLeft.x, textObj.topLeft.y);\r\n}\r\n\r\nexport function drawImage(imageObj: ImageUI, ctx: CanvasRenderingContext2D | undefined | null): void {\r\n  if (!ctx)\r\n    return;\r\n  const img = new Image();\r\n  img.src = imageObj.src;\r\n  img.onload = () => {\r\n    ctx.drawImage(img, imageObj.topLeft.x, imageObj.topLeft.y, imageObj.size.width, imageObj.size.height);\r\n  };\r\n}",["101","102"],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\components\\Canvas\\canvasNewEdi.tsx",["103","104","105","106","107","108","109","110","111","112","113"],"import React, { useState, useRef, useEffect } from 'react'\r\nimport { connect } from \"react-redux\"\r\nimport { Tool } from '../../modelsTS/Editor'\r\nimport { ImageUI } from '../../modelsTS/ImagUI'\r\nimport { Point } from '../../modelsTS/Point'\r\nimport {drawTriangle, drawRectangle, drawEllipse} from \"../../functionsTS/DrawElements\"\r\nimport { Ellipse, Primitive, Rectangle, Triangle } from '../../modelsTS/Primitives'\r\nimport * as actionTypes from \"../../store/actions\"\r\n\r\nimport classes from \"./canvas.module.css\"\r\n\r\nconst RESIZING_RADIUS = 8;\r\nconst MIN_WIDTH = 20;\r\nconst MIN_HEIGHT = 20;\r\n\r\n\r\nconst Canvas = (props: any) => {\r\n  const [downpos, setDownpos] = useState<Point>({x: 0, y: 0});\r\n  const canvasEl = useRef<HTMLCanvasElement|null>(null);\r\n  const [inFigure, setInFigure] = useState<Boolean>(false);\r\n  const shapeBorder = useRef({left: 0, top: 0, width: 0, height: 0});\r\n  const [drawing, setDrawing] = useState(false);\r\n  const [resizing, setResizing] = useState(false);\r\n  const movedelta = useRef(0);\r\n  const resizePos = useRef(0);\r\n  const img = useRef<HTMLImageElement|null>(null);\r\n\r\n  const updateShapeBorder = (loc: Point) => {\r\n    const width = Math.abs(loc.x - downpos.x);\r\n    const height = Math.abs(loc.y - downpos.y);\r\n    let left, top;\r\n\r\n    if (loc.x > downpos.x) {\r\n      left = downpos.x;\r\n    } else {\r\n      left = loc.x;\r\n    }\r\n\r\n    if (loc.y > downpos.y) {\r\n      top = downpos.y;\r\n    } else {\r\n      top = loc.y;\r\n    }\r\n\r\n    shapeBorder.current = {\r\n      left: left,\r\n      top: top,\r\n      width: width,\r\n      height: height\r\n    }\r\n  }\r\n\r\n  const getMousePosition = (x: number, y: number) => {\r\n    if (canvasEl.current) {\r\n      const ctx = canvasEl.current.getContext('2d');\r\n      const canvasSizeData = canvasEl.current.getBoundingClientRect();\r\n      return {\r\n        x: (x - canvasSizeData.left) * (canvasEl.current.width / canvasSizeData.width),\r\n        y: (y - canvasSizeData.top) * (canvasEl.current.height / canvasSizeData.height)\r\n      }\r\n    }\r\n  }\r\n\r\n  const makeFigure = (type: any) => {\r\n    return {\r\n      topLeft: {\r\n        x: shapeBorder.current.left,\r\n        y: shapeBorder.current.top\r\n      },\r\n      size: {\r\n        width: shapeBorder.current.width,\r\n        height: shapeBorder.current.height\r\n      },\r\n      type: type,\r\n      fillColor: props.fillColor,\r\n      src: props.selectedObj && props.selectedObj.type === 'image' ? props.selectedObj.src : null,\r\n      text: props.currentTool === 'text' ? props.text : null\r\n    }\r\n  }\r\n\r\n  const isInFigure = (loc: Point) => {\r\n    if (props.selectedObj && loc && canvasEl.current) {\r\n      if (props.selectedObj.type === 'area') return false;\r\n      if (loc.x < props.selectedObj.topLeft.x\r\n        || loc.x > props.selectedObj.topLeft.x + props.selectedObj.size.width\r\n        || loc.x > props.selectedObj.topLeft.x + props.selectedObj.size.width\r\n        || loc.y < props.selectedObj.topLeft.y\r\n        || loc.y > props.selectedObj.topLeft.y + props.selectedObj.size.height) {\r\n          return false;\r\n      } else {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  const isInResizingZone = (loc: Point) => {\r\n    if (props.selectedObj && loc && canvasEl.current) {\r\n      const obj = {...props.selectedObj};\r\n      const resizingZone = {\r\n        start: {\r\n          leftTop: {\r\n            x: obj.topLeft.x,\r\n            y: obj.topLeft.y\r\n          },\r\n          rightTop: {\r\n            x: obj.topLeft.x + obj.size.width,\r\n            y: obj.topLeft.y\r\n          },\r\n          leftBottom: {\r\n            x: obj.topLeft.x,\r\n            y: obj.topLeft.y + obj.size.height\r\n          },\r\n          rightBottom: {\r\n            x: obj.topLeft.x + obj.size.width,\r\n            y: obj.topLeft.y + obj.size.height\r\n          }\r\n        },\r\n        end: {\r\n          leftTop: {\r\n            x: obj.topLeft.x - RESIZING_RADIUS * 2,\r\n            y: obj.topLeft.y - RESIZING_RADIUS * 2\r\n          },\r\n          rightTop: {\r\n            x: obj.topLeft.x + obj.size.width + RESIZING_RADIUS * 2,\r\n            y: obj.topLeft.y - RESIZING_RADIUS * 2\r\n          },\r\n          leftBottom: {\r\n            x: obj.topLeft.x - RESIZING_RADIUS * 2,\r\n            y: obj.topLeft.y + obj.size.height + RESIZING_RADIUS * 2\r\n          },\r\n          rightBottom: {\r\n            x: obj.topLeft.x + obj.size.width + RESIZING_RADIUS * 2,\r\n            y: obj.topLeft.y + obj.size.height + RESIZING_RADIUS * 2\r\n          }\r\n        }\r\n      }\r\n      if (loc.x < resizingZone.start.leftTop.x && loc.x > resizingZone.end.leftTop.x && loc.y < resizingZone.start.leftTop.y && loc.y > resizingZone.end.leftTop.y) {\r\n        return 1;\r\n      } else if (loc.x > resizingZone.start.rightTop.x && loc.x < resizingZone.end.rightTop.x && loc.y < resizingZone.start.rightTop.y && loc.y > resizingZone.end.rightTop.y) {\r\n        return 2;\r\n      } else if (loc.x < resizingZone.start.leftBottom.x && loc.x > resizingZone.end.leftBottom.x && loc.y > resizingZone.start.leftBottom.y && loc.y <resizingZone.end.leftBottom.y) {\r\n        return 3;\r\n      } else if (loc.x > resizingZone.start.rightBottom.x && loc.x < resizingZone.end.rightBottom.x && loc.y > resizingZone.start.rightBottom.y && loc.y < resizingZone.end.rightBottom.y) {\r\n        return 4;\r\n      }\r\n      return false;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  const drawResizingElements = () => {\r\n    const ctx = canvasEl.current?.getContext('2d');\r\n    ctx?.beginPath();\r\n    ctx?.arc(shapeBorder.current.left - RESIZING_RADIUS, shapeBorder.current.top - RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n    ctx?.stroke();\r\n    ctx?.beginPath();\r\n    ctx?.arc(shapeBorder.current.left + shapeBorder.current.width + RESIZING_RADIUS, shapeBorder.current.top - RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n    ctx?.stroke();\r\n    ctx?.beginPath();\r\n    ctx?.arc(shapeBorder.current.left - RESIZING_RADIUS, shapeBorder.current.top + shapeBorder.current.height + RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n    ctx?.stroke();\r\n    ctx?.beginPath();\r\n    ctx?.arc(shapeBorder.current.left + shapeBorder.current.width + RESIZING_RADIUS, shapeBorder.current.top + shapeBorder.current.height + RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n    ctx?.stroke();\r\n    ctx?.beginPath();\r\n    ctx?.strokeRect(shapeBorder.current.left, shapeBorder.current.top, shapeBorder.current.width, shapeBorder.current.height);\r\n    ctx?.closePath();\r\n  }\r\n\r\n  const drawSelectedObject = () => {\r\n    const ctx = canvasEl.current?.getContext('2d');\r\n    if (ctx) {\r\n      ctx.fillStyle = props.fillColor;\r\n    }\r\n    const object = {\r\n      topLeft: {\r\n        x: props.selectedObj.topLeft.x,\r\n        y: props.selectedObj.topLeft.y\r\n      },\r\n      size: {\r\n        width: props.selectedObj.size.width,\r\n        height: props.selectedObj.size.height\r\n      }\r\n    }\r\n    switch (props.selectedObj.type) {\r\n      case 'rectangle':\r\n        drawRectangle(object, ctx);\r\n        break;\r\n      case 'ellipse':\r\n        drawEllipse(object, ctx);\r\n        break;\r\n      case 'triangle':\r\n        drawTriangle(object, ctx);\r\n        break;\r\n      case 'text':\r\n        if (ctx) {\r\n          ctx.font = `normal ${props.fontSize}px ${props.fontFamily}`;\r\n        }\r\n        let width = props.selectedObj.size.width;\r\n        if (props.fontSize * (props.text.length - 2.5) > width) {\r\n          width = props.fontSize * (props.text.length - 2.5)\r\n          console.log('[NE LEZET]')\r\n        }\r\n        ctx?.beginPath();\r\n        ctx?.fillText(props.text, props.selectedObj.topLeft.x , props.selectedObj.topLeft.y + (+props.fontSize));\r\n        break;\r\n      // case 'area':\r\n      //   if (ctx) {\r\n      //     ctx.strokeStyle = 'violet';\r\n      //   }\r\n      //   ctx?.strokeRect(props.selectedObj.topLeft.x, props.selectedObj.topLeft.y, props.selectedObj.size.width, props.selectedObj.size.height);\r\n      //   break;\r\n      case 'image':\r\n        if (img.current && img.current.src === props.selectedObj.src || img.current && !props.selectedObj.src) {\r\n          ctx?.drawImage(img.current, props.selectedObj.topLeft.x, props.selectedObj.topLeft.y, img.current.width, img.current.height)\r\n        } else {\r\n            const image = new Image();\r\n            image.src = props.selectedObj.src;\r\n            image.onload = () => {\r\n            const width = image.width;\r\n            const height = image.height;\r\n            shapeBorder.current.left = props.selectedObj.topLeft.x;\r\n            shapeBorder.current.top = props.selectedObj.topLeft.y;\r\n            shapeBorder.current.width = width;\r\n            shapeBorder.current.height = height;\r\n            img.current = image;\r\n            ctx?.drawImage(image, shapeBorder.current.left, shapeBorder.current.top, width, height)\r\n          }\r\n        }\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const ctx = canvasEl.current?.getContext('2d');\r\n    ctx?.clearRect(0, 0, props.width, props.height);\r\n    ctx?.putImageData(props.data, 0, 0);\r\n    if (props.selectedObj) {\r\n      drawSelectedObject();\r\n      ctx?.beginPath();\r\n      ctx?.arc(props.selectedObj.topLeft.x - RESIZING_RADIUS, props.selectedObj.topLeft.y - RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n      ctx?.stroke();\r\n      ctx?.beginPath();\r\n      ctx?.arc(props.selectedObj.topLeft.x + props.selectedObj.size.width +  RESIZING_RADIUS, props.selectedObj.topLeft.y - RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n      ctx?.stroke();\r\n      ctx?.beginPath();\r\n      ctx?.arc(props.selectedObj.topLeft.x - RESIZING_RADIUS, props.selectedObj.topLeft.y + props.selectedObj.size.height + RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n      ctx?.stroke();\r\n      ctx?.beginPath();\r\n      ctx?.arc(props.selectedObj.topLeft.x + props.selectedObj.size.width + RESIZING_RADIUS, props.selectedObj.topLeft.y + props.selectedObj.size.height + RESIZING_RADIUS, RESIZING_RADIUS, 0, Math.PI * 2);\r\n      ctx?.stroke();\r\n      ctx?.strokeRect(props.selectedObj.topLeft.x, props.selectedObj.topLeft.y, props.selectedObj.size.width, props.selectedObj.size.height);\r\n      ctx?.closePath();\r\n    }\r\n  }, [props.selectedObj, props.text, props.fontSize, props.fillColor]) //LAST CHANGES [filterClor]\r\n\r\n  return (\r\n    <div className={classes.Canvas}>\r\n      <canvas id=\"canvas\" width={props.width} height={props.height} ref={canvasEl}\r\n        onMouseDown={(e) => {\r\n          const loc = getMousePosition(e.clientX, e.clientY);\r\n          if (loc) {\r\n            let pointInFigure = isInFigure(loc);\r\n            let pointInResizing = isInResizingZone(loc);\r\n            if (pointInFigure) {\r\n              setInFigure(true);\r\n              drawResizingElements();\r\n            } else if (pointInResizing) {\r\n              resizePos.current = pointInResizing;\r\n              setResizing(true);\r\n            } else {\r\n              const ctx = canvasEl.current?.getContext('2d');\r\n              ctx?.clearRect(0, 0, props.width, props.height);\r\n              ctx?.putImageData(props.data, 0, 0);\r\n              const imgData = ctx?.getImageData(0, 0, props.data.width, props.data.height);\r\n              props.saveImageData(imgData);\r\n              if (props.selectedObj) {\r\n                drawSelectedObject();\r\n              }\r\n              setDrawing(true);\r\n            }\r\n            setDownpos(loc);\r\n          }\r\n        }}\r\n        onMouseMove={(e) => {\r\n          const loc = getMousePosition(e.clientX, e.clientY);\r\n          const ctx = canvasEl.current?.getContext('2d');\r\n          if (drawing && loc && ctx) {\r\n            console.log('[DRAWING]', props.currentTool)\r\n            movedelta.current = Math.abs(e.movementX) + Math.abs(e.movementY);\r\n            updateShapeBorder(loc);\r\n            ctx.clearRect(0, 0, props.width, props.height);\r\n            ctx.putImageData(props.data, 0, 0);\r\n            if (props.selectedObj) {\r\n              drawSelectedObject();\r\n            }\r\n            if (ctx) {\r\n              ctx.fillStyle = props.fillColor;\r\n            }\r\n            const object = {\r\n              topLeft: {\r\n                x: shapeBorder.current.left,\r\n                y: shapeBorder.current.top\r\n              },\r\n              size: {\r\n                width: shapeBorder.current.width,\r\n                height: shapeBorder.current.height\r\n              }\r\n            }\r\n            switch (props.currentTool) {\r\n              case Tool.rectangle:\r\n                drawRectangle(object, ctx);\r\n                break;\r\n              case Tool.ellipse:\r\n                drawEllipse(object, ctx);\r\n                break;\r\n              case Tool.triangle:\r\n                drawTriangle(object, ctx);\r\n                break;\r\n              case Tool.text:\r\n                if (ctx) {\r\n                  ctx.font = `normal ${props.fontSize}px Arial`;\r\n                }\r\n                ctx.beginPath();\r\n                ctx.fillText(props.text, shapeBorder.current.left, shapeBorder.current.top + (+props.fontSize));\r\n                break;\r\n              default:\r\n                break;\r\n            }\r\n            drawResizingElements();\r\n          } else if (inFigure && loc && canvasEl.current) {\r\n            console.log('[MOVING]')\r\n            if (ctx) {\r\n              ctx.fillStyle = props.fillColor;\r\n            }\r\n            movedelta.current = Math.abs(e.movementX) + Math.abs(e.movementY);\r\n            shapeBorder.current.left += e.movementX;\r\n            shapeBorder.current.top += e.movementY;\r\n            const object = {\r\n              topLeft: {\r\n                x: shapeBorder.current.left,\r\n                y: shapeBorder.current.top\r\n              },\r\n              size: {\r\n                width: shapeBorder.current.width,\r\n                height: shapeBorder.current.height\r\n              }\r\n            }\r\n            ctx?.clearRect(0, 0, props.width, props.height);\r\n            ctx?.putImageData(props.data, 0, 0);\r\n            if (props.selectedObj.type === 'image' && img.current) {\r\n              ctx?.drawImage(img.current, shapeBorder.current.left, shapeBorder.current.top, shapeBorder.current.width, shapeBorder.current.height)\r\n            }\r\n            switch (props.selectedObj.type) {\r\n              case Tool.rectangle:\r\n                drawRectangle(object, ctx);\r\n                break;\r\n              case Tool.ellipse:\r\n                drawEllipse(object, ctx);\r\n                break;\r\n              case Tool.triangle:\r\n                drawTriangle(object, ctx);\r\n                break;\r\n              default:\r\n                break;\r\n            }\r\n            drawResizingElements();\r\n          } else if (resizing && loc && canvasEl.current) {\r\n            movedelta.current = Math.abs(e.movementX) + Math.abs(e.movementY);\r\n            let isWidthMin = shapeBorder.current.width < MIN_WIDTH;\r\n            let isHeightMin = shapeBorder.current.height < MIN_HEIGHT;\r\n            if (resizePos.current === 1) {\r\n              if (!isWidthMin || e.movementX < 0) {\r\n                shapeBorder.current.left += e.movementX;\r\n                shapeBorder.current.width += (-e.movementX);\r\n              }\r\n              if (!isHeightMin || e.movementY < 0) {\r\n                shapeBorder.current.top += e.movementY;\r\n                shapeBorder.current.height += (-e.movementY);\r\n              }\r\n            }\r\n            else if (resizePos.current === 2) {\r\n              if (!isWidthMin || e.movementX > 0) {\r\n                shapeBorder.current.width += (e.movementX);\r\n              }\r\n              if (!isHeightMin || e.movementY < 0) {\r\n                shapeBorder.current.top += e.movementY;\r\n                shapeBorder.current.height += (-e.movementY);\r\n              }\r\n            } else if (resizePos.current === 3) {\r\n              if (!isWidthMin || e.movementX < 0) {\r\n                shapeBorder.current.left += e.movementX;\r\n                shapeBorder.current.width += (-e.movementX);\r\n              }\r\n              if (!isHeightMin || e.movementY > 0) {\r\n                shapeBorder.current.height += (e.movementY);\r\n              }\r\n              \r\n            } else if (resizePos.current === 4) {\r\n              if (!isWidthMin || e.movementX > 0) {\r\n                shapeBorder.current.width += e.movementX;\r\n              }\r\n              if (!isHeightMin || e.movementY > 0) {\r\n                shapeBorder.current.height += e.movementY;\r\n              }\r\n            }\r\n            const object = {\r\n              topLeft: {\r\n                x: shapeBorder.current.left,\r\n                y: shapeBorder.current.top\r\n              },\r\n              size: {\r\n                width: shapeBorder.current.width,\r\n                height: shapeBorder.current.height\r\n              }\r\n            }\r\n            ctx?.clearRect(0, 0, props.width, props.height);\r\n            ctx?.putImageData(props.data, 0, 0);\r\n            if (props.selectedObj && props.selectedObj.type === 'image' && img.current) {\r\n              console.log('[RESIZING]', props.selectedObj.type)\r\n              ctx?.drawImage(img.current, shapeBorder.current.left, shapeBorder.current.top, shapeBorder.current.width, shapeBorder.current.height);\r\n            } else {\r\n              switch (props.selectedObj.type) {\r\n                case Tool.rectangle:\r\n                  drawRectangle(object, ctx);\r\n                  break;\r\n                case Tool.ellipse:\r\n                  drawEllipse(object, ctx);\r\n                  break;\r\n                case Tool.triangle:\r\n                  drawTriangle(object, ctx);\r\n                  break;\r\n                default:\r\n                  break;\r\n              }\r\n            }\r\n            drawResizingElements();\r\n          }\r\n        }}\r\n        onMouseUp={(e) => {\r\n          const loc = getMousePosition(e.pageX, e.pageY);\r\n          const ctx = canvasEl.current?.getContext('2d');\r\n          if (movedelta.current === 0 && drawing && props.selectedObj) {\r\n            drawSelectedObject();\r\n          }\r\n          if (movedelta.current !== 0) {\r\n            if (img.current && (inFigure || resizing)) {\r\n              const object = {\r\n                topLeft: {\r\n                  x: shapeBorder.current.left,\r\n                  y: shapeBorder.current.top\r\n                },\r\n                size: {\r\n                  width: img.current.width,\r\n                  height: img.current.height\r\n                },\r\n                src: img.current.src,\r\n                type: 'image'\r\n              }\r\n              props.changeSelectedObject(object);\r\n            }\r\n            if (drawing) {\r\n              ctx?.clearRect(0, 0, props.width, props.height);\r\n              ctx?.putImageData(props.data, 0, 0);\r\n              if (img.current) {\r\n                ctx?.drawImage(img.current, props.selectedObj.topLeft.x, props.selectedObj.topLeft.y, img.current.width, img.current.height);\r\n                img.current = null;\r\n              }\r\n              else if (props.selectedObj) {\r\n                drawSelectedObject();\r\n              }\r\n              const imgData = ctx?.getImageData(0, 0, props.data.width, props.data.height);\r\n              props.putInHistory(props.data);\r\n              props.saveImageData(imgData);\r\n            }\r\n            if (props.selectedObj && props.selectedObj.type === 'image' && resizing && img.current && loc) {\r\n              console.log('[IMAGE UP]', shapeBorder.current)\r\n              img.current.width = shapeBorder.current.width;\r\n              img.current.height = shapeBorder.current.height;\r\n              ctx?.drawImage(img.current, shapeBorder.current.left, shapeBorder.current.top, shapeBorder.current.width, shapeBorder.current.height);\r\n            }\r\n            else if (loc && (drawing || resizing)) {\r\n              console.log('[CHANGED_OBJECT]')\r\n              const object = makeFigure(props.currentTool);\r\n              props.changeSelectedObject(object);\r\n            } else if (movedelta.current !== 0 && loc && inFigure) {\r\n              console.log('[CHANGED_OBJECT]')\r\n              const object = makeFigure(props.selectedObj.type);\r\n              props.changeSelectedObject(object);\r\n            }\r\n          }\r\n          movedelta.current = 0;\r\n          resizePos.current = 0;\r\n          setDrawing(false);\r\n          setInFigure(false);\r\n          setResizing(false);\r\n        }}\r\n        ></canvas>\r\n    </div>\r\n  )\r\n}\r\n\r\nconst mapStateToProps = (state: any) => {\r\n  return {\r\n    selectedObj: state.editor.selectedObject,\r\n    data: state.editor.canvas,\r\n    currentTool: state.editor.currentTool,\r\n    width: state.editor.canvas.width,\r\n    height: state.editor.canvas.height,\r\n    fillColor: state.view.fillColor,\r\n    text: state.view.text,\r\n    fontSize: state.view.fontSize\r\n  }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch: any) => {\r\n  return {\r\n    changeSelectedObject: (newObject: any) => dispatch({type: actionTypes.CHANGE_SELECTED_OBJECT, newObject: newObject}),\r\n    saveImageData: (imgData: ImageData) => dispatch({type: actionTypes.SAVE_IMAGE_DATA, data: imgData}),\r\n    putInHistory: (imgData: ImageData) => dispatch({type: actionTypes.PUT_IN_HISTORY, data: imgData})\r\n  }\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(Canvas);","D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\reducers\\view.tsx",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\functionsTS\\DrawElements.tsx",[],"D:\\Программирование\\React\\MyApps\\new-editor\\src\\store\\reducers\\editor.tsx",["114"],"import { stat } from 'fs';\r\nimport { Editor, Tool } from '../../modelsTS/Editor';\r\nimport { Filter } from '../../modelsTS/Filter';\r\n\r\nimport * as actionTypes from \"../actions\"\r\n\r\nconst initialState: Editor = {\r\n  canvas: new ImageData(800, 600),\r\n  selectedObject: null,\r\n  filterColor: Filter.red,\r\n  currentTool: Tool.rectangle,\r\n}\r\n\r\nconst reducer = (state = initialState, action: any) => {\r\n  switch (action.type) {\r\n    case actionTypes.CHANGE_SELECTED_OBJECT:\r\n      console.log(action.newObject)\r\n      return {\r\n        ...state,\r\n        selectedObject: { ...action.newObject }\r\n      }\r\n    case actionTypes.CHANGE_CURRENT_TOOL:\r\n      return {\r\n        ...state,\r\n        currentTool: action.tool,\r\n      }\r\n    case actionTypes.SAVE_IMAGE_DATA:\r\n      return {\r\n        ...state,\r\n        canvas: action.data\r\n      }\r\n    case actionTypes.DELETE_SELECTED_AREA:\r\n      const canvas: HTMLCanvasElement | null = document.querySelector('#canvas');\r\n      if (canvas && state.selectedObject) {\r\n        const ctx = canvas.getContext('2d')\r\n        ctx?.clearRect(0, 0, state.canvas.width, state.canvas.height);\r\n        ctx?.putImageData(state.canvas, 0, 0);\r\n        ctx?.clearRect(state.selectedObject.topLeft.x, state.selectedObject.topLeft.y, state.selectedObject.size.width, state.selectedObject.size.height)\r\n        const newData = ctx?.getImageData(0, 0, canvas.width, canvas.height);\r\n        return {\r\n          ...state,\r\n          canvas: newData\r\n        }\r\n      }\r\n      return state;\r\n    case actionTypes.APPLY_FILTER:\r\n      const canvas1: HTMLCanvasElement | null = document.querySelector(\"#canvas\");\r\n      const ctx = canvas1?.getContext('2d');\r\n      if (!ctx) return state;\r\n      const imgData: ImageData = ctx.createImageData(state.canvas.width, state.canvas.height);\r\n      imgData.data.set(state.canvas.data);\r\n      console.log('STATE', state)\r\n      console.log(imgData)\r\n      switch (action.color) {\r\n        case Filter.grey:\r\n          console.log('GREY')\r\n          for (let i = 0; i < imgData.height; i++) {\r\n            for (let j = 0; j < imgData.width; j++) {\r\n              let dataIndex = (i * imgData.width + j) * 4;\r\n              let ave = (imgData.data[dataIndex] + imgData.data[dataIndex + 1] + imgData.data[dataIndex + 2]) / 3;\r\n              for (var k = 0; k < 3; k++) {\r\n                imgData.data[dataIndex + k] = ave;\r\n              }\r\n            }\r\n          }\r\n        break;\r\n        case Filter.blue:\r\n          addFilter(imgData, [0, 0, 1, 1]);\r\n          break;\r\n        case 'green':\r\n          addFilter(imgData, [0, 1, 0, 1]);\r\n        break;\r\n        case 'red':\r\n          addFilter(imgData, [1, 0, 0, 1]);\r\n        break;\r\n      }\r\n      return {\r\n        ...state,\r\n        canvas: imgData\r\n      }\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nfunction addFilter(imgData: ImageData, filterArray: Array<number>) {\r\n  for (let i = 0; i < imgData.height; i++) {\r\n    for (let j = 0; j < imgData.width; j++) {\r\n      let dataIndex = (i * imgData.width + j) * 4;\r\n      for (let k = 0; k < 4; k++) {\r\n        imgData.data[dataIndex + k] *= filterArray[k];\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport default reducer;",{"ruleId":"115","replacedBy":"116"},{"ruleId":"117","replacedBy":"118"},{"ruleId":"119","severity":1,"message":"120","line":1,"column":16,"nodeType":"121","messageId":"122","endLine":1,"endColumn":24},{"ruleId":"119","severity":1,"message":"123","line":1,"column":26,"nodeType":"121","messageId":"122","endLine":1,"endColumn":32},{"ruleId":"119","severity":1,"message":"124","line":8,"column":10,"nodeType":"121","messageId":"122","endLine":8,"endColumn":14},{"ruleId":"119","severity":1,"message":"125","line":9,"column":8,"nodeType":"121","messageId":"122","endLine":9,"endColumn":14},{"ruleId":"119","severity":1,"message":"126","line":1,"column":10,"nodeType":"121","messageId":"122","endLine":1,"endColumn":16},{"ruleId":"119","severity":1,"message":"124","line":1,"column":18,"nodeType":"121","messageId":"122","endLine":1,"endColumn":22},{"ruleId":"119","severity":1,"message":"127","line":2,"column":10,"nodeType":"121","messageId":"122","endLine":2,"endColumn":16},{"ruleId":"119","severity":1,"message":"128","line":1,"column":10,"nodeType":"121","messageId":"122","endLine":1,"endColumn":14},{"ruleId":"119","severity":1,"message":"123","line":1,"column":16,"nodeType":"121","messageId":"122","endLine":1,"endColumn":22},{"ruleId":"119","severity":1,"message":"123","line":1,"column":16,"nodeType":"121","messageId":"122","endLine":1,"endColumn":22},{"ruleId":"119","severity":1,"message":"129","line":1,"column":17,"nodeType":"121","messageId":"122","endLine":1,"endColumn":26},{"ruleId":"119","severity":1,"message":"130","line":7,"column":10,"nodeType":"121","messageId":"122","endLine":7,"endColumn":17},{"ruleId":"119","severity":1,"message":"131","line":2,"column":10,"nodeType":"121","messageId":"122","endLine":2,"endColumn":17},{"ruleId":"119","severity":1,"message":"132","line":2,"column":19,"nodeType":"121","messageId":"122","endLine":2,"endColumn":28},{"ruleId":"119","severity":1,"message":"133","line":2,"column":30,"nodeType":"121","messageId":"122","endLine":2,"endColumn":38},{"ruleId":"115","replacedBy":"134"},{"ruleId":"117","replacedBy":"135"},{"ruleId":"119","severity":1,"message":"130","line":4,"column":10,"nodeType":"121","messageId":"122","endLine":4,"endColumn":17},{"ruleId":"119","severity":1,"message":"131","line":7,"column":10,"nodeType":"121","messageId":"122","endLine":7,"endColumn":17},{"ruleId":"119","severity":1,"message":"136","line":7,"column":19,"nodeType":"121","messageId":"122","endLine":7,"endColumn":28},{"ruleId":"119","severity":1,"message":"132","line":7,"column":30,"nodeType":"121","messageId":"122","endLine":7,"endColumn":39},{"ruleId":"119","severity":1,"message":"133","line":7,"column":41,"nodeType":"121","messageId":"122","endLine":7,"endColumn":49},{"ruleId":"119","severity":1,"message":"137","line":55,"column":13,"nodeType":"121","messageId":"122","endLine":55,"endColumn":16},{"ruleId":"138","severity":1,"message":"139","line":215,"column":25,"nodeType":"140","messageId":"141","endLine":215,"endColumn":27},{"ruleId":"138","severity":1,"message":"139","line":215,"column":70,"nodeType":"140","messageId":"141","endLine":215,"endColumn":72},{"ruleId":"138","severity":1,"message":"142","line":215,"column":70,"nodeType":"140","messageId":"141","endLine":215,"endColumn":72},{"ruleId":"138","severity":1,"message":"142","line":215,"column":85,"nodeType":"140","messageId":"141","endLine":215,"endColumn":87},{"ruleId":"143","severity":1,"message":"144","line":258,"column":6,"nodeType":"145","endLine":258,"endColumn":70,"suggestions":"146"},{"ruleId":"119","severity":1,"message":"128","line":1,"column":10,"nodeType":"121","messageId":"122","endLine":1,"endColumn":14},"no-native-reassign",["147"],"no-negated-in-lhs",["148"],"@typescript-eslint/no-unused-vars","'useState' is defined but never used.","Identifier","unusedVar","'useRef' is defined but never used.","'Tool' is defined but never used.","'Canvas' is defined but never used.","'Editor' is defined but never used.","'Filter' is defined but never used.","'stat' is defined but never used.","'useEffect' is defined but never used.","'ImageUI' is defined but never used.","'Ellipse' is defined but never used.","'Rectangle' is defined but never used.","'Triangle' is defined but never used.",["147"],["148"],"'Primitive' is defined but never used.","'ctx' is assigned a value but never used.","no-mixed-operators","Unexpected mix of '&&' and '||'.","LogicalExpression","unexpectedMixedOperator","Unexpected mix of '||' and '&&'.","react-hooks/exhaustive-deps","React Hook useEffect has missing dependencies: 'drawSelectedObject', 'props.data', 'props.height', and 'props.width'. Either include them or remove the dependency array.","ArrayExpression",["149"],"no-global-assign","no-unsafe-negation",{"desc":"150","fix":"151"},"Update the dependencies array to be: [props.selectedObj, props.text, props.fontSize, props.fillColor, props.width, props.height, props.data, drawSelectedObject]",{"range":"152","text":"153"},[10119,10183],"[props.selectedObj, props.text, props.fontSize, props.fillColor, props.width, props.height, props.data, drawSelectedObject]"]